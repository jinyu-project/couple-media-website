# 文件管理功能说明

## 已实现功能

### 后端功能

#### 1. 文件上传接口
- **路径**: `POST /api/files/upload`
- **功能**:
  - 支持单文件上传（使用 multer 中间件）
  - 自动按文件类型分类存储：
    - 照片 → `/uploads/photos/`
    - 视频 → `/uploads/videos/`
    - 文档 → `/uploads/docs/`
  - 文件类型验证：
    - 照片：jpg, png, webp, gif（最大 5MB）
    - 视频：mp4, mov, webm（最大 100MB）
    - 文档：pdf, docx, doc, txt, xlsx, xls（最大 20MB）
  - 自动生成唯一文件名（时间戳-随机数-原始文件名）
  - 保存文件元数据到 MongoDB

#### 2. 文件列表查询接口
- **路径**: `GET /api/files` 或 `GET /api/files/type/:type`
- **功能**:
  - 支持按类型筛选（photo/video/document）
  - 支持分页（page, limit 参数）
  - 按上传时间倒序排序
  - 返回文件列表和总数

#### 3. 文件预览/下载接口
- **路径**: `GET /api/files/preview/*`
- **功能**:
  - 安全文件访问（路径验证）
  - 自动设置正确的 Content-Type
  - 支持下载模式（?download=true 参数）
  - 支持所有文件类型的预览

#### 4. 其他接口
- `GET /api/files/:id` - 获取文件详情
- `PUT /api/files/:id` - 更新文件信息
- `DELETE /api/files/:id` - 删除文件（同时删除物理文件和数据库记录）
- `POST /api/files/:id/favorite` - 收藏/取消收藏文件

### 前端功能

#### 1. 文件上传组件 (`FileUpload`)
- **功能特性**:
  - ✅ 多文件上传支持
  - ✅ 拖拽上传
  - ✅ 上传进度条显示
  - ✅ 文件类型限制（前端验证）
  - ✅ 文件大小限制（前端验证）
  - ✅ 上传状态显示（待上传/上传中/成功/失败）
  - ✅ 错误提示

#### 2. 文件列表组件 (`FileList`)
- **功能特性**:
  - ✅ 卡片式布局
  - ✅ 按文件类型分类展示
  - ✅ 显示文件名称、大小、上传时间
  - ✅ 照片/视频缩略图显示
  - ✅ 悬停显示操作按钮（预览、下载）
  - ✅ 收藏功能
  - ✅ 删除功能
  - ✅ 响应式设计

#### 3. 文件预览组件 (`FilePreview`)
- **功能特性**:
  - ✅ 照片预览：点击放大，支持左右切换（键盘方向键）
  - ✅ 视频预览：在线播放，带播放/暂停/进度条控制
  - ✅ 文档预览：PDF 在线预览，其他文档显示下载按钮
  - ✅ 全屏预览模式
  - ✅ 收藏/下载操作
  - ✅ 键盘快捷键支持（ESC 关闭，左右箭头切换）

#### 4. 页面集成
- **照片页面** (`/photos`): 集成上传、列表、预览功能
- **视频页面** (`/videos`): 集成上传、列表、预览功能
- **文档页面** (`/documents`): 集成上传、列表、预览功能
- **首页** (`/`): 显示各类型文件统计数量

## 文件类型支持

### 照片
- 格式：JPG, PNG, WebP, GIF
- 最大大小：5MB
- 预览：图片放大预览，支持左右切换

### 视频
- 格式：MP4, MOV, WebM
- 最大大小：100MB
- 预览：在线播放器，支持播放控制

### 文档
- 格式：PDF, DOCX, DOC, TXT, XLSX, XLS
- 最大大小：20MB
- 预览：PDF 在线预览，其他格式显示下载按钮

## 浏览器兼容性

- ✅ Chrome/Edge（Chromium 内核）
- ✅ Safari
- ✅ Firefox

所有功能均使用标准 Web API，确保主流浏览器兼容性。

## 使用说明

### 上传文件
1. 进入对应页面（照片/视频/文档）
2. 点击"上传"按钮
3. 拖拽文件到上传区域或点击选择文件
4. 选择文件后点击"开始上传"
5. 等待上传完成

### 预览文件
1. 在文件列表中点击文件卡片
2. 照片：使用左右箭头或键盘方向键切换
3. 视频：使用播放器控制播放
4. 文档：PDF 可直接预览，其他格式点击下载

### 管理文件
- **收藏**：点击文件卡片上的心形图标
- **删除**：点击文件卡片上的删除按钮
- **下载**：在预览界面或文件卡片悬停时点击下载按钮

## 技术实现

### 后端技术栈
- Express.js - Web 框架
- Multer - 文件上传中间件
- MongoDB + Mongoose - 数据存储
- 文件系统 - 本地文件存储

### 前端技术栈
- React 18 - UI 框架
- React Router v6 - 路由
- Tailwind CSS - 样式
- shadcn/ui - UI 组件
- Fetch API - HTTP 请求
- XMLHttpRequest - 文件上传进度

## 注意事项

1. **文件存储**：文件存储在服务器 `uploads/` 目录下，按类型分文件夹
2. **用户认证**：当前使用临时占位符，后续需要集成用户认证系统
3. **文件大小**：上传大文件时请耐心等待，进度条会显示上传进度
4. **网络错误**：如果上传失败，请检查网络连接后重试

